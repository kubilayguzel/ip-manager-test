<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>IP Manager - Toplu Belge İndeksleme</title>
  <link rel="stylesheet" href="css/shared-styles.css">
  <script type="module" src="js/layout-loader.js"></script>
  <script type="module" src="js/bulk-indexing-logic.js"></script>
</head>
<body>
  <div id="notification-container"></div>
  <div id="layout-placeholder"></div>
    <div class="page-wrapper">
    <main class="main-container">
        <div class="page-header-section">
            <h1 class="page-title">Toplu Belge İndeksleme</h1>
            <p class="page-subtitle">Birden fazla PDF dosyasını yükleyin ve işlemleri hızlıca indeksleyin.</p>
        </div>
<div class="form-container">
  <div class="form-section">
    <h2 class="section-title"><span>1.</span> Toplu Belge Yükleme ve İndeksleme</h2>
    
    <div class="form-group">
      <label class="form-label" for="bulkDeliveryDate">
        A- Ortak Tebliğ Tarihi <span style="color: red;">*</span>
      </label>
      <input type="date" id="bulkDeliveryDate" class="form-input" style="max-width: 300px;">
    </div>
    <div class="form-group">
      <label class="form-label" for="bulkFiles">
        B- PDF Dosyalarını Yükleyin <span style="color: red;">*</span>
      </label>
      <div class="file-upload-wrapper">
        <input type="file" id="bulkFiles" multiple accept=".pdf" name="bulkFiles">
        <div class="file-upload-button" id="bulkFilesButton">PDF Dosyalarını Seç</div>
      </div>
      <div class="file-upload-info" id="bulkFilesInfo">Henüz PDF dosyası seçilmedi.</div>
    </div>
  </div>    

  <div class="form-section">
    <div class="bulk-tabs-container" style="margin-top: 20px;">
      <button type="button" class="bulk-tab-btn active" data-bulk-tab="pending-bulk-pane">Bekleyen İşlemler</button>
      <button type="button" class="bulk-tab-btn" data-bulk-tab="processed-bulk-pane">İşlenmiş Olanlar</button>
    </div>

    <div class="bulk-tab-content-container">
      <div id="pending-bulk-pane" class="bulk-tab-pane active">
        <div id="bulkTableNoJobs" class="text-muted p-4">İşlem listesi boş. Lütfen PDF dosyaları yükleyin.</div>
        <div id="bulkTableContainer" class="bulk-table-container" style="display: none;">
          <table class="table table-bordered bulk-table" id="bulkIndexingTable">
            <thead>
              <tr>
                <th><input type="checkbox" id="selectAllBulkJobs" title="Tümünü Seç/Bırak"></th>
                <th>PDF Dosyası</th>
                <th>Başvuru No</th>
                <th>Eşleşen Kayıt</th>
                <th>Ana İşlem</th>
                <th>Alt İşlem</th>
                <th>Tebliğ Tarihi</th>
                <th>Durum</th>
                <th>İşlemler</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div id="processed-bulk-pane" class="bulk-tab-pane">
        <div id="indexedBulkTableNoJobs" class="text-muted p-4">Daha önce işlenmiş bir kayıt bulunmuyor.</div>
        <div id="indexedBulkTableContainerProcessed" class="bulk-table-container" style="display: none;">
          <table class="table table-bordered bulk-table" id="indexedBulkTable">
            <thead>
              <tr>
                <th>PDF Dosyası</th>
                <th>Başvuru No</th>
                <th>Eşleşen Kayıt</th>
                <th>Ana İşlem</th>
                <th>Alt İşlem</th>
                <th>Tebliğ Tarihi</th>
                <th>Durum</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
</main>
</div>
<script type="module">
  import { loadSharedLayout } from './js/layout-loader.js';
  loadSharedLayout();
</script>

<script type="module">
  import { authService, ipRecordsService } from './firebase-config.js';
  import { BulkIndexingModule } from './js/bulk-indexing-logic.js';

  async function initBulk() {
    // Firebase'den mevcut kayıtları çekelim
    const recordsResult = await ipRecordsService.getRecords();
    let allRecords = [];
    if (recordsResult.success) {
      allRecords = recordsResult.data;
    }
    // Modülü başlat
    new BulkIndexingModule(allRecords);
  }

  initBulk();
</script>

</body>
</html>
