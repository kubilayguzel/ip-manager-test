<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Manager - Marka Benzerlik Aramasƒ±</title>
    <link rel="stylesheet" href="css/shared-styles.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
        }

        .page-wrapper {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .main-container {
            flex: 1;
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        .page-header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .page-title {
            font-size: 2em;
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .search-controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .control-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: end;
            flex-wrap: wrap;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        .control-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .control-input, .control-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .control-input:focus, .control-select:focus {
            outline: none;
            border-color: #007bff;
        }

        .search-button {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.3);
        }

        .monitoring-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            overflow: hidden;
        }

        .monitoring-header {
            background: #f8f9fa;
            padding: 20px 25px;
            border-bottom: 1px solid #e9ecef;
        }

        .monitoring-title {
            font-size: 1.3em;
            color: #1e3c72;
            margin: 0;
        }

        .monitoring-filters {
            padding: 20px 25px;
            border-bottom: 1px solid #f0f0f0;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 150px;
        }

        .monitoring-content {
            padding: 25px;
        }

        .monitoring-table {
            width: 100%;
            border-collapse: collapse;
        }

        .monitoring-table th,
        .monitoring-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        .monitoring-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .monitoring-table tr:hover {
            background: rgba(0, 123, 255, 0.02);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-new { background: #e3f2fd; color: #1976d2; }
        .status-monitored { background: #e8f5e8; color: #388e3c; }
        .status-expired { background: #ffebee; color: #d32f2f; }

        .loading, .no-records, .error {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            margin: 20px 0;
        }

        .results-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .results-header {
            background: #f8f9fa;
            padding: 20px 25px;
            border-bottom: 1px solid #e9ecef;
        }

        .results-title {
            font-size: 1.3em;
            color: #1e3c72;
            margin: 0;
        }

        .results-content {
            padding: 25px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
        }

        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: top;
        }

        .results-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .results-table tr:hover {
            background: rgba(0, 123, 255, 0.02);
        }

        .trademark-name {
            font-weight: 600;
            color: #1e3c72;
        }

        .monitoring-badge {
            background: #fff3cd;
            color: #856404;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.75em;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="layout-placeholder"></div>
    <div class="page-wrapper">
        <main class="main-container">
            <section class="page-header">
                <h1 class="page-title">üîç Marka Benzerlik Aramasƒ±</h1>
                <p class="page-subtitle">ƒ∞zleme listenizdeki markalara benzer yeni ba≈üvurularƒ± bulun ve genel arama yapƒ±n.</p>
            </section>

            <div class="search-controls">
                <div class="control-row">
                    <div class="control-group">
                        <label class="control-label" for="bulletin-select">B√ºlten Se√ßin:</label>
                        <select id="bulletin-select" class="control-select">
                            <option value="">Y√ºkleniyor...</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="owner-filter">Sahip Filtresi (ƒ∞steƒüe Baƒülƒ±):</label>
                        <input type="text" id="owner-filter" class="control-input" placeholder="Sahip adƒ± girin...">
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="nice-class-filter">Nice Sƒ±nƒ±fƒ± (ƒ∞steƒüe Baƒülƒ±):</label>
                        <input type="text" id="nice-class-filter" class="control-input" placeholder="√ñrn: 35, 9, 42">
                    </div>
                    <div class="control-group">
                        <button id="search-button" class="search-button">üîç Ara</button>
                    </div>
                </div>
            </div>

            <div class="monitoring-section">
                <div class="monitoring-header">
                    <h2 class="monitoring-title">üìä ƒ∞zleme Listesi</h2>
                </div>
                <div class="monitoring-filters">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="control-label" for="owner-search">Sahip Ara:</label>
                            <input type="text" id="owner-search" class="control-input" placeholder="Sahip adƒ±...">
                        </div>
                        <div class="filter-group">
                            <label class="control-label" for="nice-search">Nice Sƒ±nƒ±fƒ±:</label>
                            <input type="text" id="nice-search" class="control-input" placeholder="Nice sƒ±nƒ±fƒ±...">
                        </div>
                    </div>
                </div>
                <div class="monitoring-content">
                    <div id="loading-monitoring-list" class="loading">ƒ∞zleme listesi y√ºkleniyor...</div>
                    <div id="no-monitoring-records" class="no-records" style="display: none;">ƒ∞zleme listeniz bo≈ü.</div>
                    <table id="monitoring-table" class="monitoring-table" style="display: none;">
                        <thead>
                            <tr>
                                <th>Marka Adƒ±</th>
                                <th>Ba≈üvuru No</th>
                                <th>Sahip</th>
                                <th>Nice Sƒ±nƒ±flarƒ±</th>
                                <th>Ba≈üvuru Tarihi</th>
                                <th>Durum</th>
                            </tr>
                        </thead>
                        <tbody id="monitoring-list-body"></tbody>
                    </table>
                </div>
            </div>

            <div class="results-section">
                <div class="results-header">
                    <h2 class="results-title">üìã Arama Sonu√ßlarƒ±</h2>
                </div>
                <div class="results-content">
                    <div id="loading-results" class="loading" style="display: none;">Arama yapƒ±lƒ±yor...</div>
                    <div id="no-results" class="no-records">Arama yapmak i√ßin yukarƒ±daki filtreleri kullanƒ±n.</div>
                    <div id="search-results" style="display: none;"></div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
    <script type="module">
        import { loadSharedLayout } from './js/layout-loader.js';
        import { authService, monitoringService, personService } from './firebase-config.js';
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDbdqfiVbobnl1BtyiWxhD4bfIcREw8ZRc",
            authDomain: "ip-manager-production-aab4b.firebaseapp.com",
            projectId: "ip-manager-production-aab4b",
            storageBucket: "ip-manager-production-aab4b.firebasestorage.app",
            messagingSenderId: "594650169512",
            appId: "1:594650169512:web:43496005e063a40511829d",
            measurementId: "G-QY1P3ZCMC4"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let algoliaClient, index;
        let monitoringTrademarks = [];
        let filteredMonitoringTrademarks = [];
        let currentResults = [];
        let allPersons = []; // Ki≈üi bilgileri i√ßin

        // DOM elements
        const bulletinSelect = document.getElementById('bulletin-select');
        const ownerFilter = document.getElementById('owner-filter');
        const niceClassFilter = document.getElementById('nice-class-filter');
        const searchButton = document.getElementById('search-button');
        const loadingMonitoringList = document.getElementById('loading-monitoring-list');
        const noMonitoringRecords = document.getElementById('no-monitoring-records');
        const monitoringTable = document.getElementById('monitoring-table');
        const monitoringListBody = document.getElementById('monitoring-list-body');
        const ownerSearchInput = document.getElementById('owner-search');
        const niceSearchInput = document.getElementById('nice-search');
        const loadingResults = document.getElementById('loading-results');
        const noResults = document.getElementById('no-results');
        const searchResults = document.getElementById('search-results');

        function initializeAlgolia() {
            algoliaClient = algoliasearch('THCIEJJTZ9', 'b6c38850bfc00adcf0ecdd9a14638c27');
            index = algoliaClient.initIndex('trademark_bulletin_records');
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await loadSharedLayout({ activeMenuLink: 'trademark-similarity-search.html' });
        });

        // Auth state monitoring
        authService.auth.onAuthStateChanged(async (user) => {
            if (user) {
                initializeAlgolia();
                await loadPersons(); // Ki≈üileri y√ºkle
                await loadBulletinOptions();
                await loadMonitoringTrademarks();
                setupEventListeners();
            } else {
                window.location.href = 'index.html';
            }
        });

        // Ki≈üileri y√ºkle
        async function loadPersons() {
            try {
                const personsResult = await personService.getPersons();
                if (personsResult.success) {
                    allPersons = personsResult.data || [];
                    console.log('Ki≈üiler y√ºklendi:', allPersons.length);
                } else {
                    console.warn('Ki≈üiler y√ºklenirken hata:', personsResult.error);
                    allPersons = [];
                }
            } catch (error) {
                console.warn('Ki≈üiler y√ºklenirken hata:', error);
                allPersons = [];
            }
        }

        // Sahip bilgisini i≈üleme fonksiyonu
        function processOwnerInfo(owners) {
            try {
                if (owners && Array.isArray(owners)) {
                    return owners.map(owner => {
                        if (typeof owner === 'object' && owner.id) {
                            const match = allPersons.find(p => p.id === owner.id);
                            return match ? match.name : `ID:${owner.id}`;
                        } else if (typeof owner === 'string') {
                            return owner;
                        } else if (typeof owner === 'object' && owner.name) {
                            return owner.name;
                        }
                        return 'Bilinmeyen';
                    }).join(', ');
                } else if (typeof owners === 'string') {
                    return owners;
                }
                return '-';
            } catch (error) {
                console.warn('Sahip bilgisi i≈ülenirken hata:', error);
                return '-';
            }
        }

        async function loadMonitoringTrademarks() {
            const user = authService.getCurrentUser();
            if (!user) return;

            showMonitoringLoading(true);
            
            try {
                const result = await monitoringService.getMonitoringItems(user.uid);
                if (result.success) {
                    monitoringTrademarks = result.data || [];
                    filteredMonitoringTrademarks = [...monitoringTrademarks];
                    renderMonitoringList(filteredMonitoringTrademarks);
                    console.log(`${monitoringTrademarks.length} izleme markasƒ± y√ºklendi`);
                } else {
                    console.error('ƒ∞zleme listesi y√ºklenirken hata:', result.error);
                    showMonitoringError('ƒ∞zleme listesi y√ºklenirken bir hata olu≈ütu.');
                }
            } catch (error) {
                console.error('ƒ∞zleme listesi y√ºkleme hatasƒ±:', error);
                showMonitoringError('ƒ∞zleme listesi y√ºklenirken bir hata olu≈ütu.');
            }
        }

        function renderMonitoringList(trademarks) {
            showMonitoringLoading(false);
            
            if (!trademarks || trademarks.length === 0) {
                showMonitoringNoRecords();
                return;
            }

            const tableHTML = trademarks.map(trademark => {
                const owners = processOwnerInfo(trademark.owners); // G√ºncellenen fonksiyon
                const niceClasses = Array.isArray(trademark.niceClass) 
                    ? trademark.niceClass.join(', ') 
                    : trademark.niceClass || '';
                const applicationDate = trademark.applicationDate 
                    ? formatDate(trademark.applicationDate) 
                    : '';
                const status = getTrademarkStatus(trademark.status);

                return `
                    <tr data-id="${trademark.id}">
                        <td><strong>${trademark.title || trademark.markName || ''}</strong></td>
                        <td>${trademark.applicationNumber || trademark.applicationNo || ''}</td>
                        <td>${owners}</td>
                        <td>${niceClasses}</td>
                        <td>${applicationDate}</td>
                        <td><span class="status-badge status-${status.class}">${status.text}</span></td>
                    </tr>
                `;
            }).join('');

            monitoringListBody.innerHTML = tableHTML;
            monitoringTable.style.display = '';
        }

        function filterMonitoringTrademarks() {
            const ownerFilter = ownerSearchInput.value.toLowerCase().trim();
            const niceFilter = niceSearchInput.value.trim();

            filteredMonitoringTrademarks = monitoringTrademarks.filter(trademark => {
                const owners = processOwnerInfo(trademark.owners).toLowerCase();
                const ownerMatch = !ownerFilter || owners.includes(ownerFilter);

                const niceClasses = Array.isArray(trademark.niceClass) 
                    ? trademark.niceClass.join(',') 
                    : trademark.niceClass || '';
                const niceMatch = !niceFilter || niceClasses.includes(niceFilter);

                return ownerMatch && niceMatch;
            });

            renderMonitoringList(filteredMonitoringTrademarks);
            console.log(`Filtre sonrasƒ± ${filteredMonitoringTrademarks.length} marka g√∂steriliyor`);
        }

        function setupEventListeners() {
            searchButton.addEventListener('click', performSearch);
            ownerSearchInput.addEventListener('input', filterMonitoringTrademarks);
            niceSearchInput.addEventListener('input', filterMonitoringTrademarks);
        }

        async function performSearch() {
            const bulletinId = bulletinSelect.value;
            if (!bulletinId) {
                alert('L√ºtfen bir b√ºlten se√ßin.');
                return;
            }

            showResultsLoading(true);

            try {
                const ownerFilterValue = ownerFilter.value.trim();
                const niceFilterValue = niceClassFilter.value.trim();

                // Eƒüer sadece b√ºlten se√ßili ve diƒüer filtreler bo≈üsa, monitoring trademarks'tan arama yap
                if (!ownerFilterValue && !niceFilterValue) {
                    await performMonitoringTrademarkSearch(bulletinId);
                    return;
                }

                // Normal Algolia aramaya devam et
                let searchQuery = '';
                let filters = [];

                if (ownerFilterValue) {
                    searchQuery = ownerFilterValue;
                }

                filters.push(`bulletinId:"${bulletinId}"`);

                if (niceFilterValue) {
                    filters.push(`niceClasses:"${niceFilterValue}"`);
                }

                const searchOptions = {
                    hitsPerPage: 1000,
                    attributesToRetrieve: [
                        'markName', 'applicationNo', 'holders', 'niceClasses', 
                        'bulletinId', 'applicationDate', 'imagePath'
                    ],
                    filters: filters.join(' AND ')
                };

                const { hits } = await index.search(searchQuery, searchOptions);
                currentResults = hits;
                
                renderResults(hits);
                
            } catch (error) {
                console.error('Arama hatasƒ±:', error);
                showError('Arama sƒ±rasƒ±nda bir hata olu≈ütu. L√ºtfen tekrar deneyiniz.');
            }
        }

        async function performMonitoringTrademarkSearch(bulletinId) {
            try {
                console.log('Filtrelenmi≈ü izleme listesi √ºzerinden arama ba≈ülatƒ±lƒ±yor...');
                
                const trademarksToSearch = filteredMonitoringTrademarks.length > 0 
                    ? filteredMonitoringTrademarks 
                    : monitoringTrademarks;

                console.log(`${trademarksToSearch.length} marka i√ßin arama yapƒ±lacak`);

                if (trademarksToSearch.length === 0) {
                    showError('Filtrelenmi≈ü izleme listesinde marka bulunamadƒ±.');
                    return;
                }

                const allSimilarResults = [];
                let processedCount = 0;

                for (const trademark of trademarksToSearch) {
                    processedCount++;
                    const markName = trademark.title || trademark.markName;
                    console.log(`${processedCount}/${trademarksToSearch.length}: ${markName} ara≈ütƒ±rƒ±lƒ±yor...`);
                    
                    try {
                        const { hits } = await index.search(markName, {
                            filters: `bulletinId:"${bulletinId}"`,
                            hitsPerPage: 1000,
                        });

                        for (const hit of hits) {
                            if (hit.applicationNo === (trademark.applicationNumber || trademark.applicationNo)) {
                                continue;
                            }

                            allSimilarResults.push({
                                ...hit,
                                monitoredTrademark: markName,
                                monitoredApplicationNo: trademark.applicationNumber || trademark.applicationNo
                            });
                        }
                    } catch (searchError) {
                        console.error(`${markName} i√ßin arama hatasƒ±:`, searchError);
                    }
                }

                console.log(`Toplam ${allSimilarResults.length} benzer sonu√ß bulundu`);
                currentResults = allSimilarResults;
                renderMonitoringResults(allSimilarResults);

            } catch (error) {
                console.error('Monitoring trademark arama hatasƒ±:', error);
                showError('ƒ∞zleme listesi aramasƒ± sƒ±rasƒ±nda bir hata olu≈ütu.');
            }
        }

        function renderMonitoringResults(results) {
            showResultsLoading(false);
            
            if (results.length === 0) {
                showError('ƒ∞zlenen markalarƒ±nƒ±za benzer yeni marka bulunamadƒ±.');
                return;
            }

            const tableHTML = results.map(hit => {
                const holders = Array.isArray(hit.holders) ? hit.holders.join(', ') : hit.holders || '';
                const niceClasses = Array.isArray(hit.niceClasses) ? hit.niceClasses.join(', ') : hit.niceClasses || '';
                const applicationDate = hit.applicationDate ? formatDate(hit.applicationDate) : '';

                return `
                    <tr>
                        <td><strong class="trademark-name">${hit.markName || ''}</strong></td>
                        <td>${hit.applicationNo || ''}</td>
                        <td>${holders}</td>
                        <td>${niceClasses}</td>
                        <td>${applicationDate}</td>
                        <td><span class="monitoring-badge">Benzer: ${hit.monitoredTrademark}</span></td>
                    </tr>
                `;
            }).join('');

            searchResults.innerHTML = `
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Marka Adƒ±</th>
                            <th>Ba≈üvuru No</th>
                            <th>Sahip</th>
                            <th>Nice Sƒ±nƒ±flarƒ±</th>
                            <th>Ba≈üvuru Tarihi</th>
                            <th>ƒ∞zlenen Marka</th>
                        </tr>
                    </thead>
                    <tbody>${tableHTML}</tbody>
                </table>
            `;
            searchResults.style.display = '';
            noResults.style.display = 'none';
        }

        function renderResults(results) {
            showResultsLoading(false);
            
            if (results.length === 0) {
                showError('Arama kriterlerinize uygun sonu√ß bulunamadƒ±.');
                return;
            }

            const tableHTML = results.map(hit => {
                const holders = Array.isArray(hit.holders) ? hit.holders.join(', ') : hit.holders || '';
                const niceClasses = Array.isArray(hit.niceClasses) ? hit.niceClasses.join(', ') : hit.niceClasses || '';
                const applicationDate = hit.applicationDate ? formatDate(hit.applicationDate) : '';

                return `
                    <tr>
                        <td><strong class="trademark-name">${hit.markName || ''}</strong></td>
                        <td>${hit.applicationNo || ''}</td>
                        <td>${holders}</td>
                        <td>${niceClasses}</td>
                        <td>${applicationDate}</td>
                    </tr>
                `;
            }).join('');

            searchResults.innerHTML = `
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Marka Adƒ±</th>
                            <th>Ba≈üvuru No</th>
                            <th>Sahip</th>
                            <th>Nice Sƒ±nƒ±flarƒ±</th>
                            <th>Ba≈üvuru Tarihi</th>
                        </tr>
                    </thead>
                    <tbody>${tableHTML}</tbody>
                </table>
            `;
            searchResults.style.display = '';
            noResults.style.display = 'none';
        }

        // Utility functions
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('tr-TR');
            } catch (e) {
                return dateString;
            }
        }

        function getTrademarkStatus(status) {
            switch (status) {
                case 'application': return { text: 'Ba≈üvuru', class: 'new' };
                case 'registered': return { text: 'Tescilli', class: 'monitored' };
                case 'rejected': return { text: 'Reddedildi', class: 'expired' };
                case 'pending': return { text: 'Beklemede', class: 'new' };
                default: return { text: 'ƒ∞zleniyor', class: 'monitored' };
            }
        }

        function showMonitoringLoading(show) {
            if (show) {
                loadingMonitoringList.style.display = 'block';
                monitoringTable.style.display = 'none';
                noMonitoringRecords.style.display = 'none';
            } else {
                loadingMonitoringList.style.display = 'none';
            }
        }

        function showMonitoringNoRecords() {
            noMonitoringRecords.style.display = 'block';
            monitoringTable.style.display = 'none';
            loadingMonitoringList.style.display = 'none';
        }

        function showMonitoringError(message) {
            showMonitoringLoading(false);
            noMonitoringRecords.innerHTML = `<div class="error">${message}</div>`;
            noMonitoringRecords.style.display = 'block';
        }

        function showResultsLoading(show) {
            if (show) {
                loadingResults.style.display = 'block';
                searchResults.style.display = 'none';
                noResults.style.display = 'none';
            } else {
                loadingResults.style.display = 'none';
            }
        }

        function showError(message) {
            showResultsLoading(false);
            noResults.innerHTML = `<div class="error">${message}</div>`;
            noResults.style.display = 'block';
            searchResults.style.display = 'none';
        }

        async function loadBulletinOptions() {
            try {
                const snapshot = await getDocs(collection(db, 'trademarkBulletins'));
                const bulletins = [];
                snapshot.forEach(doc => bulletins.push({ id: doc.id, ...doc.data() }));
                
                bulletinSelect.innerHTML = '<option value="">B√ºlten se√ßin...</option>' + 
                    bulletins.map(b => `<option value="${b.id}">${b.bulletinNo} - ${b.bulletinDate}</option>`).join('');
            } catch (error) {
                console.error('B√ºlten se√ßenekleri y√ºklenirken hata:', error);
                bulletinSelect.innerHTML = '<option value="">B√ºlten y√ºklenirken hata olu≈ütu</option>';
            }
        }
    </script>
</body>
</html>